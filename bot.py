import discord
from discord.ext import commands
import os
import re
import random
from dotenv import load_dotenv
import google.generativeai as genai # ‡∏û‡∏£‡∏∞‡πÄ‡∏≠‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà
# from myserver import server_on # ‡∏ñ‡πâ‡∏≤‡∏£‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ comment ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö

# ===== LOAD ENV =====
load_dotenv()
TOKEN = os.getenv("DISCORD_TOKEN")
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY") # ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô .env ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö

# ===== SETUP AI (GEMINI) =====
genai.configure(api_key=GEMINI_API_KEY)
model = genai.GenerativeModel('gemini-1.5-flash') # ‡∏£‡∏∏‡πà‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏ü‡∏£‡∏µ

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å AI (System Prompt)
# ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏á‡πÇ‡∏Ñ‡πâ‡∏î ‡∏õ‡∏≤‡∏Å‡πÅ‡∏à‡πã‡∏ß‡∏ô‡∏¥‡∏î‡πÜ ‡πÅ‡∏ï‡πà‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢
ai_persona = """
‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏π‡πà‡∏Ñ‡∏¥‡∏î‡πÉ‡∏ô Discord ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏°‡∏≤‡∏Å 
‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏≠ "BotKub" (‡∏ö‡∏≠‡∏ó‡∏Ñ‡∏£‡∏±‡∏ö) 
‡∏ô‡∏¥‡∏™‡∏±‡∏¢: ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á, ‡∏Å‡∏ß‡∏ô‡∏ï‡∏µ‡∏ô‡∏ô‡∏¥‡∏î‡πÜ, ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô, ‡∏ä‡∏≠‡∏ö‡∏™‡∏≠‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢, ‡∏´‡πâ‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏¢‡∏≤‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡πã‡∏≤‡πÜ
‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡∏≤‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î ‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á, ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡∏≤‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏•‡πà‡∏ô ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
"""

# ===== INTENTS =====
intents = discord.Intents.default()
intents.message_content = True
bot = commands.Bot(command_prefix="!", intents=intents)

# ===== BAD WORDS =====
bad_words = [
    "‡∏Ñ‡∏ß‡∏¢", "‡πÄ‡∏´‡∏µ‡πâ‡∏¢", "‡∏™‡∏±‡∏ô‡∏î‡∏≤‡∏ô", "‡∏´‡∏µ",
    "‡∏´‡∏£‡∏£‡∏°", "‡∏´‡∏≥", "‡πÇ‡∏á‡πà", "‡∏Å‡∏≤‡∏Å", "‡∏Å‡∏£‡∏∞‡∏à‡∏≠‡∏Å"
]

# ===== CLEAN TEXT =====
def clean_text(text: str) -> str:
    text = text.lower()
    text = re.sub(r"\s+", "", text)
    text = re.sub(r"[^‡∏Å-‡πôa-z0-9]", "", text)
    return text

# =====================
# üß† LOCAL BRAIN (‡∏™‡∏°‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤ - ‡∏ï‡∏≠‡∏ö‡πÄ‡∏£‡πá‡∏ß ‡∏Å‡∏ß‡∏ô‡∏ï‡∏µ‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)
# =====================
brain = []
topics = {
    "‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢": ["‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö", "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ", "‡∏´‡∏ß‡∏±‡∏î‡∏î‡∏µ", "hi", "hello", "‡∏ó‡∏±‡∏Å"],
    "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì": ["‡∏Ç‡∏≠‡∏ö‡πÉ‡∏à", "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì", "thx", "thank"],
    "‡∏ï‡∏•‡∏Å": ["555", "‡∏ï‡∏•‡∏Å", "‡∏Ç‡∏≥"]
}
answers_pool = {
    "‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢": ["‡πÇ‡∏¢‡πà‡∏ß‡∏ß‡∏ß ‡∏ß‡πà‡∏≤‡πÑ‡∏á‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô", "‡∏î‡∏µ‡∏à‡πâ‡∏≤ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ö‡πâ‡∏≤‡∏á‡∏¢‡∏±‡∏á?", "‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö‡∏ú‡∏° ‡∏°‡∏µ‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢?"],
    "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì": ["‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ô", "‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Å‡∏≤‡πÅ‡∏ü‡πÅ‡∏Å‡πâ‡∏ß‡∏ô‡∏∂‡∏á‡∏û‡∏≠", "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏ú‡∏°"],
    "‡∏ï‡∏•‡∏Å": ["‡∏Ç‡∏≥‡πÑ‡∏£‡∏≠‡∏∞ ‡πÅ‡∏ö‡πà‡∏á‡∏°‡∏±‡πà‡∏á", "‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏∑‡πâ‡∏ô‡∏ô‡∏∞‡πÄ‡∏£‡∏≤", "55555555"]
}

for topic, keys in topics.items():
    brain.append({"tags": keys, "answers": answers_pool.get(topic, ["‡∏≠‡∏∑‡∏°‡∏°‡∏°"])})

# =====================
# EVENTS
# =====================
@bot.event
async def on_ready():
    print(f"Bot ready as {bot.user} | Hybrid Brain Activated!")

@bot.event
async def on_message(message):
    if message.author.bot:
        return

    raw = message.content.strip()
    content = clean_text(raw)

    # 1Ô∏è‚É£ BAD WORD CHECK
    if any(word in raw for word in bad_words):
        try: await message.delete()
        except: pass
        await message.channel.send(f"{message.author.mention} ‡∏≠‡∏¢‡πà‡∏≤‡∏´‡∏¢‡∏≤‡∏ö‡∏Ñ‡∏≤‡∏¢‡∏î‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏à‡∏±‡∏ö‡∏ï‡∏µ‡∏Å‡πâ‡∏ô‡πÄ‡∏•‡∏¢!", delete_after=5)
        return

    # 2Ô∏è‚É£ LOCAL BRAIN (‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏≥‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß)
    for item in brain:
        for tag in item["tags"]:
            if tag in content: 
                response = random.choice(item["answers"])
                await message.channel.send(f"{response} {message.author.mention}")
                return # ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ñ‡∏≤‡∏° AI

    # 3Ô∏è‚É£ AI BRAIN (‡∏ñ‡πâ‡∏≤ Local Brain ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ AI ‡∏ï‡∏≠‡∏ö)
    # ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô "‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î"
    
    # ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏≤‡∏° AI (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î Resource)
    if len(raw) < 2:
        return

    # ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå..." ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á
    async with message.channel.typing():
        try:
            # ‡∏™‡∏£‡πâ‡∏≤‡∏á Chat Session ‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á Prompt ‡πÑ‡∏õ
            # ‡πÄ‡∏£‡∏≤‡∏™‡πà‡∏á persona ‡πÑ‡∏õ‡∏Å‡∏≥‡∏Å‡∏±‡∏ö + ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
            prompt = f"{ai_persona}\n\nUser ‡∏û‡∏π‡∏î‡∏ß‡πà‡∏≤: {raw}"
            
            response = model.generate_content(prompt)
            
            # ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
            await message.channel.send(response.text)
            
        except Exception as e:
            print(f"AI Error: {e}")
            await message.channel.send("‡πÇ‡∏ó‡∏©‡∏ó‡∏µ ‡∏™‡∏°‡∏≠‡∏á‡πÄ‡∏≠‡∏≠‡πÄ‡∏£‡πà‡∏≠‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ã‡∏¥")

    await bot.process_commands(message)

# ===== RUN =====
# server_on()
bot.run(TOKEN)
